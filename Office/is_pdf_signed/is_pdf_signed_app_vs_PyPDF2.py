# conda activate allpy311

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è PDF-–¥–æ–∫—É–º–µ–Ω—Ç–∞ (–Ω–∞–ª–∏—á–∏–µ —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏)
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ PDF —Ñ–∞–π–ª —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å (–≤–∏–¥–∞ /Sig –≤ –ø–æ–ª—è—Ö —Ñ–æ—Ä–º—ã). –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
# —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∏–ª–∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

from PyPDF2 import PdfReader


def is_pdf_signed(file_path):
    try:
        reader = PdfReader(file_path)

        # –ü–æ–ª—É—á–∞–µ–º Root –æ–±—ä–µ–∫—Ç
        root = reader.trailer['/Root'].get_object()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ AcroForm
        if '/AcroForm' not in root:
            return False

        acroform = root['/AcroForm'].get_object()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π
        if '/Fields' not in acroform:
            return False

        fields = acroform['/Fields'].get_object()

        # –ü–æ–ª—è –º–æ–≥—É—Ç –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º –∏–ª–∏ –æ–¥–∏–Ω–æ—á–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º
        if hasattr(fields, '__iter__') and not isinstance(fields, dict):
            # –ï—Å–ª–∏ —ç—Ç–æ —Å–ø–∏—Å–æ–∫ (–º–∞—Å—Å–∏–≤ –ø–æ–ª–µ–π)
            field_objects = [field.get_object() for field in fields]
        else:
            # –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –ø–æ–ª–µ
            field_objects = [fields.get_object()]

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ
        for field in field_objects:
            ft = field.get('/FT')  # –¢–µ–ø–µ—Ä—å field ‚Äî —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å
            if ft == '/Sig':
                return True

    except Exception as e:
        print(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ PDF: {e}')
        return False

    return False


if __name__ == '__main__':
    path = 'doc.pdf'
    if is_pdf_signed(path):
        print("üîê –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–ø–∏—Å–∞–Ω")
    else:
        print("‚ö†Ô∏è –ü–æ–¥–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

'''
–ó–∞–º–µ—Ç–∫–∏:
1) –ù–µ –≤—Å–µ –ø–æ–¥–ø–∏—Å–∏ –≤–∏–¥–Ω—ã —á–µ—Ä–µ–∑ /FT == /Sig
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ PDF –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ (PAdES), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç—ã –∏–ª–∏ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –ø–æ–ª—è —Ñ–æ—Ä–º—ã.
–ù–æ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤, –µ—Å–ª–∏ PDF –ø–æ–¥–ø–∏—Å–∞–Ω —á–µ—Ä–µ–∑ Adobe –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏ ‚Äî –ø–æ–¥–ø–∏—Å—å –±—É–¥–µ—Ç –≤ AcroForm.

2) PyPDF2 –æ–≥—Ä–∞–Ω–∏—á–µ–Ω
PyPDF2 ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞. –†–∞—Å—Å–º–æ—Ç—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ pypdf (–µ—ë –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—Ç, —ç—Ç–æ —Ñ–æ—Ä–∫ PyPDF2) –∏–ª–∏ PyMuPDF (fitz) ‚Äî 
–æ–Ω–∏ –º–æ—â–Ω–µ–µ –∏ –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø–æ–¥–ø–∏—Å—è–º–∏.
–ü—Ä–∏–º–µ—Ä —Å pypdf: pip install pypdf
–ö–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ—á—Ç–∏ —Ç–µ–º –∂–µ, –Ω–æ pypdf ‚Äî –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–∫.
'''